<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>this 的指向 | Knowledge</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9825735b.css" as="style"><link rel="preload" href="/assets/js/app.a880bd3d.js" as="script"><link rel="preload" href="/assets/js/2.2defd20b.js" as="script"><link rel="preload" href="/assets/js/15.ae67ab21.js" as="script"><link rel="prefetch" href="/assets/js/10.8f14a7d6.js"><link rel="prefetch" href="/assets/js/11.3cfdad71.js"><link rel="prefetch" href="/assets/js/12.c3f2b724.js"><link rel="prefetch" href="/assets/js/13.2fb18602.js"><link rel="prefetch" href="/assets/js/14.8a60e2f5.js"><link rel="prefetch" href="/assets/js/16.c2631989.js"><link rel="prefetch" href="/assets/js/17.92c99ed9.js"><link rel="prefetch" href="/assets/js/18.16749f8f.js"><link rel="prefetch" href="/assets/js/19.22659ec6.js"><link rel="prefetch" href="/assets/js/3.9c2455d0.js"><link rel="prefetch" href="/assets/js/4.26f73e91.js"><link rel="prefetch" href="/assets/js/5.5dcec586.js"><link rel="prefetch" href="/assets/js/6.f2a96706.js"><link rel="prefetch" href="/assets/js/7.3a9fda4b.js"><link rel="prefetch" href="/assets/js/8.8cc414d9.js"><link rel="prefetch" href="/assets/js/9.7804fef8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9825735b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Knowledge</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javascript/" class="nav-link router-link-active">
  JavaScript
</a></div><div class="nav-item"><a href="/html/" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/note/" class="nav-link">
  笔记
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/javascript/" class="nav-link router-link-active">
  JavaScript
</a></div><div class="nav-item"><a href="/html/" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/note/" class="nav-link">
  笔记
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript 基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript/base/this.html" aria-current="page" class="active sidebar-link">this 指向</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/base/this.html#全局上下文" class="sidebar-link">全局上下文</a></li><li class="sidebar-sub-header"><a href="/javascript/base/this.html#函数上下文" class="sidebar-link">函数上下文</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/base/this.html#普通函数调用模式" class="sidebar-link">普通函数调用模式</a></li><li class="sidebar-sub-header"><a href="/javascript/base/this.html#对象中的函数-方法-调用模式" class="sidebar-link">对象中的函数（方法）调用模式</a></li><li class="sidebar-sub-header"><a href="/javascript/base/this.html#构造函数调用模式" class="sidebar-link">构造函数调用模式</a></li><li class="sidebar-sub-header"><a href="/javascript/base/this.html#原型链中的调用模式" class="sidebar-link">原型链中的调用模式</a></li><li class="sidebar-sub-header"><a href="/javascript/base/this.html#箭头函数调用模式" class="sidebar-link">箭头函数调用模式</a></li><li class="sidebar-sub-header"><a href="/javascript/base/this.html#dom-事件处理函数调用" class="sidebar-link">DOM 事件处理函数调用</a></li><li class="sidebar-sub-header"><a href="/javascript/base/this.html#优先级" class="sidebar-link">优先级</a></li></ul></li><li class="sidebar-sub-header"><a href="/javascript/base/this.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/javascript/base/extend.html" class="sidebar-link">JavaScript 继承</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript 进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="this-的指向"><a href="#this-的指向" class="header-anchor">#</a> this 的指向</h1> <p>函数的 this 在调用时绑定的。完全取决于函数的调用位置（也就是函数的调用方法）。为了搞清楚 this 的指向是什么，必须知道相关函数是如何调用的。</p> <h2 id="全局上下文"><a href="#全局上下文" class="header-anchor">#</a> 全局上下文</h2> <p>非严格模式和严格模式中 this 都是指向顶层对象（浏览器中是 window）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span> <span class="token operator">===</span> window <span class="token comment">// true</span>
<span class="token string">'use strict'</span>
<span class="token keyword">this</span> <span class="token operator">===</span> window
<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'window name'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// window name</span>
</code></pre></div><h2 id="函数上下文"><a href="#函数上下文" class="header-anchor">#</a> 函数上下文</h2> <h3 id="普通函数调用模式"><a href="#普通函数调用模式" class="header-anchor">#</a> 普通函数调用模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 非严格模式</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'window'</span>
<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'window'</span>
</code></pre></div><p>可能会误以为是 window.foo() 调用的，所以 this 指向 window。虽然本例中 window.foo 确实是等于 foo。name 等于 window.name。上述代码是因为在 ES5 中，全局变量是挂载到顶层对象（浏览器是 window）。事实上，并不是如此</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 非严格模式</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'window'</span>
<span class="token keyword">let</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> window<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true undefined</span>
</code></pre></div><p>这个例子中，let 没有给顶层对象添加属性，window.name 和 window.foo 都是 undefined</p> <p>严格模式中，普通函数的 this 则表现不同，表现为 undefined</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'window'</span>
<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span> <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true 报错，因为 this 是 undefined</span>
</code></pre></div><p>《你不知道的 JavaScript》 上卷，将这种叫做默认绑定。对 call、apply 属性的回类比为</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span>
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span>
</code></pre></div><p>效果是一样的，call、apply 作用之一就是用来修改函数中的 this 指向为第一个参数的。第一个参数是 undefined 或者 null，非严格模式下，是指向 window。严格模式下，就是指向第一个参数</p> <p>经常有这类代码（回调函数），其实也是普通函数调用模式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'name'</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 非严格模式下， 浏览器环境下 this 指向 window</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// 语法</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>fn <span class="token operator">|</span>code<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token comment">// 类比 setTimeout 函数内部调用 fn 或者执行代码 code</span>
<span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="对象中的函数-方法-调用模式"><a href="#对象中的函数-方法-调用模式" class="header-anchor">#</a> 对象中的函数（方法）调用模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'window'</span>
<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'obj name'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">foo</span><span class="token operator">:</span> foo<span class="token punctuation">,</span>
  <span class="token literal-property property">other</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'other name'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span> foo
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// obj name</span>
obj<span class="token punctuation">.</span>other<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// other name</span>
<span class="token comment">// 用 call 类比则为</span>
obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token comment">// 用call 类比则为</span>
obj<span class="token punctuation">.</span>other<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>other<span class="token punctuation">)</span>
</code></pre></div><p>但往往会有下面常见，把对象的函数赋值给另外一个变量。这样的话，调用该变量，其实就相当于调用普通函数，this 还是指向全局对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> newFoo <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo

<span class="token function">newFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// window</span>

<span class="token comment">// 类比为</span>
<span class="token function">newFoo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="构造函数调用模式"><a href="#构造函数调用模式" class="header-anchor">#</a> 构造函数调用模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// { name: 'name' }</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>

</code></pre></div><p>使用 new 操作符会执行以下步骤</p> <ul><li>创建一个全新的对象</li> <li>这个对象会被执行 <code>[[Prototype]]</code> 链接</li> <li>生成的新对象绑定到函数调用的 this</li> <li>通过 new 创建的每个对象最终被 <code>[[Prototype]]</code> 链接到这个函数的 prototype 上</li> <li>如果函数的返回值是 Object 类型（Function、Array、Date。。。）则返回这些类型，否则返回新创建的对象</li></ul> <h3 id="原型链中的调用模式"><a href="#原型链中的调用模式" class="header-anchor">#</a> 原型链中的调用模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span>

<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
student<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// name</span>
</code></pre></div><p>谁调用函数，this 就指向谁</p> <p>上述代码使用ES6 中 class 的写法则是</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">}</span>

  <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
student<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// name</span>
</code></pre></div><h3 id="箭头函数调用模式"><a href="#箭头函数调用模式" class="header-anchor">#</a> 箭头函数调用模式</h3> <p>箭头函数和普通函数的重要区别</p> <ul><li>箭头函数没有自己的 this、super、arguments 和 new.target 绑定</li> <li>不能使用 new 来调用。</li> <li>没有原型对象</li> <li>不可改变 this 的绑定</li> <li>形参名称不能重复</li></ul> <p>箭头函数中没有 this 绑定，必须通过查找作用域链来决定其值。如果箭头函数被非箭头函数包含，则 this 绑定的是最近一层非箭头函数的 this，否则 this 的值则被设置为全局对象。</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'window'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> student <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'student name'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> <span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token function-variable function">say2</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    student<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// student name</span>

    student<span class="token punctuation">.</span><span class="token function">say2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// window</span>
</code></pre></div><p>其实就是相当于箭头函数外的 this 是缓存的该箭头函数上层的普通函数的 this。如果没有普通函数，则是全局对象。也就是无法通过 call、apply、bind 绑定箭头函数的 this（他本身就没有 this）。而 call、apply、bind 可以绑定缓存箭头函数上层的普通函数的 this</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">var</span> student <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'student name'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">say</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'say'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'person name'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    student<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token comment">// student name  say student name</span>
    student<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// person name say person name</span>
</code></pre></div><p>总结：可以通过改变箭头函数上的普通函数的 this 指向，从而指定箭头函数内部的 this 指向</p> <h3 id="dom-事件处理函数调用"><a href="#dom-事件处理函数调用" class="header-anchor">#</a> DOM 事件处理函数调用</h3> <p>addEventListener、attachEvent、onclick</p> <div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>onclick<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    button<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> ev<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> list <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.list'</span><span class="token punctuation">)</span>

    list<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> ev<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>onclick 和 addEventListener 是指向绑定事件的元素。一些浏览器，比如 IE6～IE8 下使用 attachEvent，this 指向 window。</p> <p>ev.currentTarget 和 ev.target 的区别</p> <p>ev.currentTarget 是绑定事件的元素，而 ev.target 是当前触发事件的元素。比如这里的分别是 ul 和 li。但也可能惦记的是 ul。这是 ev.currentTarget === ev.target</p> <h4 id="内联事件处理函数调用"><a href="#内联事件处理函数调用" class="header-anchor">#</a> 内联事件处理函数调用</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn1<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.btn1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>再次点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="优先级"><a href="#优先级" class="header-anchor">#</a> 优先级</h3> <p>而箭头函数的 this 是上层普通函数的 this 或者是全局对象，所以排除，不算优先级</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'window'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'person'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'return:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> student <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'student'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">say</span><span class="token operator">:</span> say
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 普通函数调用</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// window</span>
    <span class="token comment">// 对象上的函数调用</span>
    student<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// student</span>
    <span class="token comment">// call、apply 调用</span>
    student<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token comment">// person</span>

    <span class="token keyword">new</span> <span class="token class-name">student<span class="token punctuation">.</span>say<span class="token punctuation">.</span>call</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
</code></pre></div><p>如果是 student.say.call(person) 先执行的情况下，那么 new 执行一个函数。是没有问题的。然而事实上，这行代码报错。运算符优先级是 new 比点号低。所以是执行 new (student.say.call(person)) 而 Function.prototype.call，虽然是一个函数（apply、bind也是函数），跟箭头函数一样，不能用 new 调用。所以报错了</p> <div class="language-js extra-class"><pre class="language-js"><code>Uncaught TypeError<span class="token operator">:</span> student<span class="token punctuation">.</span>say<span class="token punctuation">.</span>call is not a constructor
</code></pre></div><p>这是因为函数内部有两个不同的方法: <code>[[Call]]</code> 和 <code>[[Constructor]]</code> 。当使用普通函数调用时，<code>[[Call]]</code> 会被执行。当使用构造函数调用时，<code>[[Constructor]]</code>会被执行。call、apply 、bind 和箭头函数内部都没有 <code>[[Constructor]]</code> 方法</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>如果要判断一个运行中函数的 this 绑定。就需要找到这个函数直接调用位置</p> <ul><li>new 调用：绑定到新创建的对象。</li> <li>call 或者 apply 或者 bind 调用： 严格模式下，绑定到指定的第一个参数，非严格模式下，null 和 undefined，指向全局对象。其余值指向被 new Object() 包装的对象</li> <li>对象上的函数调用：绑定到那个对象</li> <li>普通函数调用：在严格模式下绑定到 undefined，否则绑定到全局对象</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/javascript/base/extend.html">
        JavaScript 继承
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a880bd3d.js" defer></script><script src="/assets/js/2.2defd20b.js" defer></script><script src="/assets/js/15.ae67ab21.js" defer></script>
  </body>
</html>
